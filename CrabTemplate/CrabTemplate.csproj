<Project Sdk="Microsoft.NET.Sdk">
	<!-- If you know what you're doing, you can change these -->
	<PropertyGroup>
		<TargetFramework>netstandard2.1</TargetFramework>
		<LangVersion>latest</LangVersion>

		<GenerateAssemblyInfo>false</GenerateAssemblyInfo>
		<AllowUnsafeBlocks>true</AllowUnsafeBlocks>
		<Nullable>disable</Nullable>
	</PropertyGroup>

	<!-- Change these! -->
	<PropertyGroup>
		<AssemblyName>lammas123.CrabTemplate</AssemblyName>
		<Product>CrabTemplate</Product>
		<Version>0.0.1</Version>

		<SteamDir Condition="'$(SteamDir)' == ''">S:\Steam</SteamDir>
		<ProfileDir Condition="'$(ProfileDir)' == ''">S:\Steam\steamapps\common\Crab Game</ProfileDir>
		<UnhollowedDir>$(ProfileDir)\BepInEx\unhollowed</UnhollowedDir>

		<!--
			If you plan to depend on other mods (ex. CrabDevKit) you may uncomment the following line and correct the path.
			Further down is a commented out example of DepsDir being used to reference CrabDevKit.
		-->
		<!-- <DepsDir Condition="'$(DepsDir)' == ''">C:\Users\lamma\source\repos\Crab Game</DepsDir> -->
	</PropertyGroup>


	<!-- Configurations -->
	<PropertyGroup>
		<Configurations>Debug;Release</Configurations>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)' == 'Debug'">
		<DebugSymbols>true</DebugSymbols>
		<DebugType>embedded</DebugType>

		<!-- Trim the path to just include the project in stack traces -->
		<PathMap>$([System.IO.Path]::GetFullPath('$(MSBuildThisFileDirectory)'))=./</PathMap>

		<AutoLaunch>true</AutoLaunch>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)' == 'Release'">
		<DebugSymbols>false</DebugSymbols>
		<DebugType>none</DebugType>

		<!-- Trim the path to just include the project in stack traces -->
		<PathMap>$([System.IO.Path]::GetFullPath('$(MSBuildThisFileDirectory)'))=./</PathMap>

		<AutoLaunch>false</AutoLaunch>
	</PropertyGroup>


	<!-- Checks -->
	<Target Name="CheckUnhollowed" BeforeTargets="ResolveAssemblyReferences">
		<Error Condition="!Exists('$(UnhollowedDir)\Assembly-CSharp.dll')" Text="Unhollowed assemblies not found. Verify $(UnhollowedDir) (your .csproj's UnhollowedDir) is correct and run BepInEx Il2Cpp unhollowing first." />
	</Target>

	<Target Name="CheckDeps" BeforeTargets="ResolveAssemblyReferences" Condition="'$(DepsDir)' != ''">
		<Error Condition="!Exists('$(DepsDir)')" Text="$(DepsDir) does not exist, correct your DepsDir within your .csproj." />
	</Target>



	<!-- Building -->
	<Target Name="ClearReferenceCopyLocalPaths" AfterTargets="ResolveAssemblyReferences">
		<ItemGroup>
			<ReferenceCopyLocalPaths Remove="@(ReferenceCopyLocalPaths)" />
		</ItemGroup>
	</Target>

	<Target Name="PostBuild" AfterTargets="PostBuildEvent" Condition="'$(AutoLaunch)' == 'true'">
		<Exec Command="copy &quot;$(OutDir)$(AssemblyName).dll&quot; &quot;$(ProfileDir)\BepInEx\plugins\$(AssemblyName)\$(AssemblyName).dll&quot;" />
		<Exec Command="$(SteamDir)\steam.exe steam://rungameid/1782210" />
	</Target>
	
	
	<!-- Dependencies -->
	<ItemGroup>
		<PackageReference Include="BepInEx.AssemblyPublicizer.MSBuild" PrivateAssets="all" Version="0.4.1">
			<!-- Suppress CS0436: AssemblyPublicizer IgnoresAccessChecksToAttribute conflicts with MonoMod.Utils, this is safe to ignore -->
			<NoWarn>$(NoWarn);CS0436</NoWarn>
		</PackageReference>

		<PackageReference Include="BepInEx.PluginInfoProps" Version="2.1.0" />
		
		<PackageReference Include="BepInEx.IL2CPP" Version="6.0.0-*" />
		<PackageReference Include="BepInEx.Preloader.Core" Version="6.0.0-*" />
	</ItemGroup>
	
	<ItemGroup>
		<!-- BepInEx Assemblies -->
		<Reference Include="0Harmony" Publicize="true">
			<HintPath>$(ProfileDir)\BepInEx\core\0Harmony.dll</HintPath>
		</Reference>
		
		<!-- Game Assemblies -->
		<Reference Include="Assembly-CSharp">
			<HintPath>$(UnhollowedDir)\Assembly-CSharp.dll</HintPath>
		</Reference>
		<Reference Include="Assembly-CSharp-firstpass">
			<HintPath>$(UnhollowedDir)\Assembly-CSharp-firstpass.dll</HintPath>
		</Reference>
		
		<!-- Il2Cpp Assemblies -->
		<Reference Include="Il2Cppmscorlib">
			<HintPath>$(UnhollowedDir)\Il2Cppmscorlib.dll</HintPath>
		</Reference>
		<Reference Include="Il2CppSystem">
			<HintPath>$(UnhollowedDir)\Il2CppSystem.dll</HintPath>
		</Reference>
		<Reference Include="Il2CppSystem.Core">
			<HintPath>$(UnhollowedDir)\Il2CppSystem.Core.dll</HintPath>
		</Reference>

		<!-- Other Mod Assemblies -->
		<!-- <Reference Include="CrabDevKit">
			<HintPath>$(DepsDir)\CrabDevKit\bin\Release\netstandard2.1\CrabDevKit.dll</HintPath>
		</Reference> -->

		<!-- Unity Assemblies-->
		<Reference Include="UnityEngine.AnimationModule">
			<HintPath>$(UnhollowedDir)\UnityEngine.AnimationModule.dll</HintPath>
		</Reference>
		<Reference Include="UnityEngine.AudioModule">
			<HintPath>$(UnhollowedDir)\UnityEngine.AudioModule.dll</HintPath>
		</Reference>
		<Reference Include="UnityEngine.CoreModule">
			<HintPath>$(UnhollowedDir)\UnityEngine.CoreModule.dll</HintPath>
		</Reference>
		<Reference Include="UnityEngine.InputLegacyModule">
			<HintPath>$(UnhollowedDir)\UnityEngine.InputLegacyModule.dll</HintPath>
		</Reference>
		<Reference Include="UnityEngine.ParticleSystemModule">
			<HintPath>$(UnhollowedDir)\UnityEngine.ParticleSystemModule.dll</HintPath>
		</Reference>
		<Reference Include="UnityEngine.PhysicsModule">
			<HintPath>$(UnhollowedDir)\UnityEngine.PhysicsModule.dll</HintPath>
		</Reference>
		<Reference Include="UnityEngine.TextRenderingModule">
			<HintPath>$(UnhollowedDir)\UnityEngine.TextRenderingModule.dll</HintPath>
		</Reference>
		<Reference Include="UnityEngine.UI">
			<HintPath>$(UnhollowedDir)\UnityEngine.UI.dll</HintPath>
		</Reference>
		
		<Reference Include="Unity.PostProcessing.Runtime">
			<HintPath>$(UnhollowedDir)\Unity.PostProcessing.Runtime.dll</HintPath>
		</Reference>
		<Reference Include="Unity.TextMeshPro">
			<HintPath>$(UnhollowedDir)\Unity.TextMeshPro.dll</HintPath>
		</Reference>
	</ItemGroup>
</Project>